---
- name: install dependencies
  pkgng: name={{item}} state=present
  with_items:
  - py27-cffi
  - py27-virtualenv

- name: create application user
  # this creates /home/pyramid/.ssh/id_rsa{.pub}
  user: name={{tahoeuser}} createhome=yes generate_ssh_key=yes

- name: ensure the tahoe data directory exists
  file: path={{tahoedata}} state=directory owner={{tahoeuser}} mode=770

- name: ensure the tahoe build directory exists
  file: path=/usr/local/tahoe-build state=directory owner={{tahoeuser}} mode=770

- name: download the tahoe-package
  get_url: dest=/usr/local/tahoe-build/ url=https://tahoe-lafs.org/source/tahoe-lafs/releases/allmydata-tahoe-1.10.0.zip validate_certs=no


# - name: configure nginx
#   template: src=nginx.conf dest=/usr/local/etc/nginx/nginx.conf

# - name: ensure the www data directory exists
#   file: path={{wwwdata}} state=directory owner={{wwwuser}} mode=770

# - name: upload the website
#   template: src=index.html dest={{wwwdata}}/index.html owner={{wwwuser}} mode=550

# - name: enable nginx at startup time
#   lineinfile: dest=/etc/rc.conf state=present line='nginx_enable=YES' create=yes

# - name: make sure nginx is running or reloaded
#   service: name=nginx state=restarted

# https://tahoe-lafs.org/source/tahoe-lafs/releases/allmydata-tahoe-1.10.0.zip
